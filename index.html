<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Voting OSIS SMAN 1 Bangsal</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="login-page" class="page-container">
        <div class="window">
            <div class="window-header">
                <div class="traffic-lights">
                    <span class="dot red"></span>
                    <span class="dot yellow"></span>
                    <span class="dot green"></span>
                </div>
                <span class="window-title">E-Voting OSIS - SMAN 1 Bangsal</span>
            </div>
            <div class="window-content">
                <form id="login-form">
                    <h2>Selamat Datang</h2>
                    <p>Silakan masuk untuk melanjutkan.</p>
                    <div class="input-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" value="(nama)@smaba.ac.id" required>
                    </div>
                    <div class="input-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" value="" required>
                    </div>
                    <div class="form-button-container">
                        <button type="submit" id="login-siswa-btn" class="btn btn-primary">Masuk sebagai Siswa</button>
                        <button type="submit" id="login-admin-btn" class="btn">Masuk sebagai Admin</button>
                    </div>
                    <p id="login-error" class="error-message"></p>
                </form>
                <div id="guest-result-container" style="display: none;">
                    <hr>
                    <button id="guest-view-result-btn" class="btn">Lihat Hasil</button>
                </div>
            </div>
        </div>
    </div>

    <div id="admin-page" class="page-container" style="display: none;">
        <div class="window">
            <div class="window-header">
                <div class="traffic-lights"></div>
                <span class="window-title">Panel Admin</span>
            </div>
            <div class="window-content">
                <div class="admin-main-grid">
                    <div class="admin-left-column">
                        <div class="admin-controls">
                            <div class="control-section">
                                <h3>Kontrol Akses Siswa</h3>
                                <p>Atur apakah siswa dapat login ke sistem.</p>
                                <button id="toggle-student-login-btn" class="btn" data-status="aktif">
                                    <span class="status-dot"></span>
                                    <span class="button-text">Aktif</span>
                                </button>
                            </div>
                            <div class="control-section">
                                <h3>Kontrol Hasil Voting</h3>
                                <p>Atur visibilitas halaman hasil untuk semua.</p>
                                <button id="toggle-result-page-btn" class="btn" data-status="nonaktif">
                                    <span class="status-dot"></span>
                                    <span class="button-text">Nonaktif</span>
                                </button>
                                <button id="admin-view-result-btn" class="btn btn-primary" style="margin-top: 10px;">Lihat Hasil Voting</button>
                            </div>
                            <div class="control-section">
                                <h3>Siaran (Broadcast)</h3>
                                <input type="text" id="broadcast-title" placeholder="Judul Siaran">
                                <textarea id="broadcast-content" placeholder="Isi siaran..."></textarea>
                                <button id="send-broadcast-btn" class="btn btn-primary">Kirim Siaran Sekarang</button>
                                <hr style="margin: 15px 0;">
                                <h4>Riwayat Siaran Aktif:</h4>
                                <div id="active-broadcasts-list">
                                    <p class="empty-list-msg">Belum ada siaran aktif.</p>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <div class="candidates-management">
                            <h3>Manajemen Kandidat</h3>
                            <div id="admin-candidate-list">
                                <p id="no-candidate-msg">Belum ada kandidat yang ditambahkan.</p>
                            </div>
                            <button id="add-candidate-btn" class="btn btn-add">+</button>
                        </div>
                    </div>
                    <div class="admin-right-column">
                        <div class="voter-data-header">
                            <h3>Data Pemilih</h3>
                            <button id="export-csv-btn" class="btn">Ekspor ke CSV</button>
                        </div>
                        <div class="voter-data-container">
                            <table id="voter-data-table">
                                <thead>
                                    <tr>
                                        <th>Foto</th>
                                        <th>Nama</th>
                                        <th>Kelas</th>
                                        <th>No. Presensi</th>
                                        <th>Pilihan</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                            <p id="no-voter-data-msg">Belum ada data pemilih yang masuk.</p>
                        </div>
                    </div>
                </div>
                <div class="page-footer-actions">
                    <button class="btn btn-logout">Log out</button>
                </div>
            </div>
        </div>
    </div>

    <div id="student-form-page" class="page-container" style="display: none;">
        <div class="window">
             <div class="window-header">
                <div class="traffic-lights"></div><span class="window-title">Konfirmasi Data Diri</span>
            </div>
            <div class="window-content">
                <form id="student-form">
                    <h2>Verifikasi Data Diri</h2>
                    <p>Harap isi data berikut dengan benar sebelum melanjutkan ke halaman voting.</p>
                    <div class="input-group photo-upload-group">
                        <label for="student-photo">Foto Wajah (Selfie)</label>
                        <img id="student-photo-preview" class="photo-preview" src="https://via.placeholder.com/120" alt="Pratinjau Foto">
                        <input type="file" id="student-photo" accept="image/*">
                    </div>
                    <div class="input-group">
                        <label for="student-name">Nama Lengkap</label>
                        <input type="text" id="student-name" required>
                    </div>
                    <div class="input-group">
                        <label for="student-class">Kelas</label>
                        <input type="text" id="student-class" placeholder="Contoh: XII MIPA 1" required>
                    </div>
                    <div class="input-group">
                        <label for="student-presence">Nomor Presensi</label>
                        <input type="number" id="student-presence" required>
                    </div>
                    <div class="input-group checkbox-group">
                        <input type="checkbox" id="student-confirmation" required>
                        <label for="student-confirmation">Saya menyatakan bahwa data yang diisi adalah benar.</label>
                    </div>
                    <div class="form-button-container">
                        <button type="submit" class="btn btn-primary">Simpan dan Lanjutkan ke Voting</button>
                    </div>
                </form>
                <div class="page-footer-actions">
                    <button class="btn btn-logout">Log out</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="voting-page" class="page-container" style="display: none;">
        <div class="window">
            <div class="window-header">
                <div class="traffic-lights"></div><span class="window-title">Halaman Voting</span>
            </div>
            <div id="voting-content" class="window-content">
                <div id="voter-info-card"></div>
                <div class="voting-header">
                    <h2>Pilih Kandidat Ketua & Wakil Ketua OSIS</h2>
                    <p>Pilih salah satu kandidat dengan menekan tombol "COBLOS".</p>
                </div>
                <div id="voter-candidate-list" class="candidate-container"></div>
                <div class="voting-actions-container">
                    <button id="edit-form-btn" class="btn">Kembali & Edit Form</button>
                    <button id="submit-vote-btn" class="btn btn-primary" disabled>Submit Pilihan</button>
                </div>
                <div class="page-footer-actions">
                    <button class="btn btn-logout">Log out</button>
                </div>
            </div>
        </div>
    </div>

    <div id="result-page" class="page-container" style="display: none;">
        <div class="window">
             <div class="window-header">
                <div class="traffic-lights"></div><span class="window-title">Hasil Voting Real-Time</span>
            </div>
            <div class="window-content">
                <h2>Perolehan Suara Sementara</h2>
                <div id="result-candidate-list" class="candidate-container"></div>
                <div class="page-footer-actions">
                    <button class="btn btn-back">Kembali</button>
                    <button class="btn btn-logout">Log out</button>
                </div>
            </div>
        </div>
    </div>

    <div id="thank-you-page" class="page-container" style="display: none;">
        <div class="window">
             <div class="window-header">
                <div class="traffic-lights"></div><span class="window-title">Vote Tercatat</span>
            </div>
            <div class="window-content content-center">
                <h2>Terima Kasih!</h2>
                <p>Pilihan Anda telah berhasil direkam oleh sistem.</p>
                <p>Anda telah menggunakan hak suara Anda dan tidak dapat memilih kembali.</p>
                <div class="page-footer-actions">
                    <button id="view-result-btn-final" class="btn btn-primary">Lihat Hasil</button>
                    <button class="btn btn-logout">Log out</button>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-container" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h3 id="modal-title">Judul Modal</h3>
            <p id="modal-text">Teks di dalam modal.</p>
            <div class="button-container" id="modal-buttons"></div>
            <span id="modal-timestamp" class="timestamp"></span>
        </div>
    </div>

    <div id="loader-overlay" style="display: none;">
        <div id="activity">
            <div class=indicator>
              <div class="segment"></div><div class="segment"></div><div class="segment"></div><div class="segment"></div><div class="segment"></div><div class="segment"></div><div class="segment"></div><div class="segment"></div><div class="segment"></div><div class="segment"></div><div class="segment"></div><div class="segment"></div>
            </div>
            <span>Loading...</span>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="script.js"></script>
</body>
</html>
